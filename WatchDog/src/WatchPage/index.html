<!DOCTYPE html>
<html lang="en">
<head>
	<title>WATCHDOG</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!--===============================================================================================-->
	<!--<link rel="icon" type="image/png" href="statics/images/icons/favicon.ico" />-->
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="statics/vendor/bootstrap/css/bootstrap.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="statics/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="statics/css/util.css">
	<link rel="stylesheet" type="text/css" href="statics/css/main.css">
	<!--===============================================================================================-->
</head>
<body>
	<section class="ftco-section">
		<div class="container">
			<div class="row justify-content-center">
				<div class="col-md-6 text-center mb-4">
					<h2 class="heading-section">WatchDog</h2>
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<div class="table-wrap">
						<table class="table myaccordion table-hover" id="accordion">
							<thead>
								<tr>
									<!--<th>#</th>-->
									<th scope="col">TYPE</th>
									<th scope="col">PATH</th>
									<th scope="col">STATUS</th>
									<th scope="col">DURATION</th>
									<th>&nbsp;</th>
								</tr>
							</thead>
							<tbody id="tableBody">
								
								<!--<tr data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour" class="collapsed">
									<th scope="row">4</th>
									<td>Laptop Technology AS2020</td>
									<td>$200.00</td>
									<td>2</td>
									<td>$400.00</td>
									<td>
										<i class="fa" aria-hidden="false"></i>
									</td>
								</tr>
								<tr>
									<td colspan="6" id="collapseFour" class="collapse acc" data-parent="#accordion">
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Porro iste, facere sunt sequi nostrum ipsa, amet doloremque magnam reiciendis tempore sapiente. Necessitatibus recusandae harum nam sit perferendis quia inventore natus.</p>
									</td>
								</tr>-->
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</section>

	<!--===============================================================================================-->
	<script src="statics/vendor/jquery/jquery-3.2.1.min.js"></script>
	<script src="statics/vendor/bootstrap/js/popper.min.js"></script>
	<script src="statics/vendor/bootstrap/js/bootstrap.min.js"></script>
	<script src="statics/signalr/signalr.js"></script>


	<script>
		$(document).ready(function () {
			$.ajax({
				type: "GET",
				url: "/watchpage",
				context: document.body,
				success: function (data) {
					console.log(data);
                    for (var i = 0; i < data.length; i++) {
                        $('#tableBody').append("<tr data-toggle='collapse' data-target='#collapse" + i + "' aria-expanded='false' aria-controls='collapse" + i + "' class='collapsed'>" +
                            "<td>" + data[i].method + "</td><td>" + data[i].path + "</td><td>" + data[i].responseStatus + "</td><td>" + data[i].timeSpent + "</td><td><i class='fa' aria-hidden='false'></i></td></tr>" +
                            "<tr><td id='collapse" + i + "' class='collapse acc' data-parent='#accordion'><p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Porro iste, facere sunt sequi nostrum ipsa, amet doloremque magnam reiciendis tempore sapiente. Necessitatibus recusandae harum nam sit perferendis quia inventore natus.</p></td></tr>");

                        //$('#tableBody').append("<tr data-toggle='collapse' data-target='#collapse" + i + "' aria-expanded='false' aria-controls='collapse" + i + "' class='collapsed'>" +
                        //    "<td>" + data[i].method + "</td><td>" + data[i].path + "</td><td>" + data[i].responseStatus + "</td><td>" + data[i].timeSpent + "</td><td><i class='fa' aria-hidden='false'></i></td></tr>" +
                        //    "<tr id='collapse" + i + "' class='collapse acc' data-parent='#accordion'><p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Porro iste, facere sunt sequi nostrum ipsa, amet doloremque magnam reiciendis tempore sapiente. Necessitatibus recusandae harum nam sit perferendis quia inventore natus.</p></tr>");

                    }
				}
			});
		});
	</script>

	<!--<script>
		console.log("...START...");
		$.ajax({
			type: "GET",
			url: '/WebPage/GetAllLogs',
			//data: { id: object_id },
			success: function (response) {
				console.log(response);
			}
		});

		$.get('/WebPage/GetAllLogs', null, function (data) {
			console.log(data);
		});
		console.log("...STOP...");

		//Creates a connection to the server hub
		var connection = new signalR.HubConnectionBuilder()
			.withUrl("/LoggerHub")
			.configureLogging(signalR.LogLevel.Information)
			.withAutomaticReconnect()
			.build();

		async function start() {
			try {
				this.connection.on("getAllLogs", (logs) => {
					console.log(logs);
					console.log("omo");
				});
				await connection.start().then(() => console.log('Connection started'))
					.catch(err => console.log('Error while starting connection: ' + err));
				//console.log("SignalR Connected.");

	//            connection.stream("GetAllLogs")
	//                .subscribe({
	//                    next: (item) => {
	//                        console.log(item);
	//                    },
	//                    complete: () => {
	//                        console.log("End of Stream");
	//                    },
				//		error: (err) => {
				//			console.log(err);
	//                    },
				//});

				//connection.invoke('Send', "hey");
			} catch (err) {
				console.log(err);
				setTimeout(start, 5000);
			}
		};

		connection.onclose(async () => {
			await start();
		});

		connection.onclose(async () => {
			await start();
		});

		// Start the connection.
		start();
	</script>-->
	<!--===============================================================================================-->
	<script src="statics/js/main.js"></script>

</body>
</html>